<?xml version="1.0"?>
<project name="EventBParser" default="sablecc-parser" basedir=".">
	
	<property name="enable_debug" value="true"/>

	<property name="dir.src" location="src" />
	<property name="dir.src_test" location="src_test" />
	<property name="dir.src_generated" location="src_generated" />

	<property name="dir.temp" location="temp" />
	<property name="dir.temp.src" location="${dir.temp}\src" />
	<property name="dir.temp.classes" location="${dir.temp}\classes" />
	<property name="dir.release" location="release"/>
	
	<property name="file.release.jar" location="${dir.release}\EventBParser.jar" />
	
	<taskdef name="sablecc" classname="org.sablecc.ant.taskdef.Sablecc" classpath="lib/ext/sablecc-anttask.jar" />
	
	<target name="init">
		<mkdir dir="${dir.temp.classes}" />
		<mkdir dir="${dir.temp.src}" />
		<mkdir dir="${dir.release}" />
	</target>

	<target name="clean">
		<delete >
			<fileset dir="${dir.src_generated}">
				<include name="**/*" />
			</fileset>
		</delete>
	</target>

	<target name="sablecc-parser" depends="clean">
		<echo message="Regenerating EventBParser sources..." />
		<java jar="lib/ext/sablecc.jar" fork="true" failonerror="true">
			<arg value="-d"/>
			<arg value="src_generated"/>
			<arg value="${basedir}/EventBParser.sablecc"/>

		</java>
	</target>

	<target name="compile" depends="init,sablecc-parser" description="">
		<copy todir="${dir.temp.src}">
		    <fileset dir="src"/>
		    <fileset dir="src_generated"/>
		</copy>		
		
		<javac srcdir="${dir.temp.src}" destdir="${dir.temp.classes}" includeAntRuntime="false" target="1.5" source="1.5"/>

		<copy file="src_generated/de/be4/eventb/core/parser/lexer/lexer.dat" todir="${dir.temp.classes}/de/be4/eventb/core/parser/lexer" />
		<copy file="src_generated/de/be4/eventb/core/parser/parser/parser.dat" todir="${dir.temp.classes}/de/be4/eventb/core/parser/parser" />
	</target>	

    <target name="jar" depends="init,compile" description="">
		<tstamp>
		    <format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss" />
		</tstamp>    	
    	
		<jar basedir="${dir.temp.classes}" destfile="${file.release.jar}" >
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Built-On" value="${TODAY}"/>
				<attribute name="Main-Class" value="de.be4.eventb.core.parser.EventBParser"/>
			</manifest>
		</jar>
		<delete dir="${dir.temp.classes}" />
    </target>

	<target name="dist" depends="jar" >
		<delete dir="${dir.temp}" />
	</target>
	
	<target name="release" depends="clean,dist"/>
</project>
